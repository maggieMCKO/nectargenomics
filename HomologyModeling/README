### Input:	cleaned/filtered nucleotide MSA of a target gene
###		original (not cleaned, not aligned) fasta sequnce of a target gene (=long)
###		MEME/other tool results specifying sites under positive selection
### Goal:	modeled structure of a target protein of species $db; sites under positive selection mapped to the structure.



### How to model protein structure based on sequnces

# get target sequnce from alignment; translate to protein
get_seq_by_name_fasta.py -f $msa -n $db > $db.short.fa
translate.py -f $db.short.fa > prot.$db.short.fa
translate.py -f $db.long.fa > prot.$db.long.fa

# go to https://swissmodel.expasy.org/interactive#structure
# submit a target sequence: prot.$db.long.fa; Providing sequence is optional
# result: $db.model.full_prot.pdb



### How to map p-values from MEME to the modeled structure 

# align long and shot prot sequnces (e.g. with mafft)
mafft both.prot.$db.fa > mafft.prot.$db.fa

# get only ATOM entries
g ^ATOM $db.model.full_prot.pdb > $db.model.ATOM.full_prot.pdb
assign_short_to_long.py -f mafft.prot.$db.fa -p $db.model.ATOM.full_prot.pdb -r 

# modify p-value file (just for the sake of representation) - get a list of -log(pval)
# NB: this list of p-values corresponds to the prot.$db.short.fa file!
awk '{print -log($2)}' pval.tsv pval.log.lst

# assign p-values to PDB atoms instead of b-factor
assign_short_to_long.py -f mafft.prot.$db.fa -p $db.model.ATOM.full_prot.pdb -f  mafft.prot.$db.fa -r pval.log.lst > meme.$db.model.ATOM.full_prot.pdb

### Pymol manipulations.
# Ideas here: align to the template used (or any other existing/modeled strucure you think is appropriate here);
# color by B-factor -> get sites in the structure colored by MEME p-value


